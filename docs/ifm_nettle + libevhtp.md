<a name="T6xOf"></a>
## 安装libhv

**cd ~**<br />**git clone https://github.com/ithewei/libhv.git**<br />**cd libhv**<br />**mkdir build**<br />**cd build**<br />**cmake ..**<br />**cmake --build .**<br />**cmake --install .**
:::

<a name="cQhBt"></a>
## 安装ifm_nettle

**cd ~**<br />// 注意，由于代码尚未合入，这里的git链接是我个人fork的仓库链接<br />**git clone git@gitee.com:ptbxzrt/ifm_nettle.git ifm_nettle**<br />**cd ifm_nettle**<br />**mkdir build**<br />**cd build**<br />**cmake ..**<br />**make -j**<br />**sudo make install**<br />我在VMware（openEuler-22.03-LTS-SP1-x86_64）上测试时，会出现找不到libhv.so的情况，因此还需要执行以下命令才能确保后面不会出错<br />**export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib**
:::

<a name="CTbQQ"></a>
## 调整libevhtp仓库相关文件

**cd ~**<br />**git clone -b 1.2.18 https://github.com/Yellow-Camper/libevhtp.git**<br />修改libevhtp/CMakeLists.txt，使其不再链接到libevent.so，而是链接到libifm_libhv2ev.so<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697995155258-967c5f96-5f27-487b-8c45-baf29f288f7a.png#averageHue=%23eae6d6&clientId=ua7b2dac9-b0f1-4&from=paste&height=230&id=ubba3e017&originHeight=459&originWidth=3666&originalType=binary&ratio=2&rotation=0&showTitle=false&size=236580&status=done&style=none&taskId=u8af3f793-4d1d-4909-9036-548832b5c2b&title=&width=1833)<br />删除libevhtp/evhtp.c中libevent相关的头文件<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697995858049-0309d36f-00c0-43c8-9e9a-a3ac61dcfa30.png#averageHue=%23fceae9&clientId=ua7b2dac9-b0f1-4&from=paste&height=82&id=u4ddc60c7&originHeight=164&originWidth=2095&originalType=binary&ratio=2&rotation=0&showTitle=false&size=30158&status=done&style=none&taskId=uc1f74664-25ed-4d71-8c32-a3739144907&title=&width=1047.5)<br />删除libevhtp/thread.c中libevent相关的头文件<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697995869215-6e47bde6-9dd9-4f1b-9b0a-29b5da988599.png#averageHue=%23fbd7d6&clientId=ua7b2dac9-b0f1-4&from=paste&height=112&id=u8775e299&originHeight=224&originWidth=2211&originalType=binary&ratio=2&rotation=0&showTitle=false&size=45519&status=done&style=none&taskId=uc6f46f51-f30d-4783-adf1-9cabd21e865&title=&width=1105.5)<br />删除libevhtp/evhtp.h中libevent相关的头文件，并添加ifm_nettle中的头文件hv2ev.h<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697995913401-caba3d4b-ac18-47ff-a09e-2625b928eb36.png#averageHue=%23fae0de&clientId=ua7b2dac9-b0f1-4&from=paste&height=238&id=u0d432a19&originHeight=476&originWidth=2502&originalType=binary&ratio=2&rotation=0&showTitle=false&size=123533&status=done&style=none&taskId=uc8922c8b-8035-45be-8c62-baf8bea5fa0&title=&width=1251)<br />删除libevhtp/thread.h中libevent相关的头文件，并添加ifm_nettle中的头文件hv2ev.h<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697995935814-2a9ef457-287e-463a-9a41-e9599bb053fd.png#averageHue=%23faebea&clientId=ua7b2dac9-b0f1-4&from=paste&height=104&id=uf71365ed&originHeight=207&originWidth=2411&originalType=binary&ratio=2&rotation=0&showTitle=false&size=44797&status=done&style=none&taskId=u1e4177b6-6723-4f57-aad9-ed3af6e1c07&title=&width=1205.5)<br />将libevhtp/examples/test.c中的libevent相关头文件替换为ifm_nettle中的头文件hv2ev.h<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697995986482-861165aa-b544-4e62-a6e9-b068c569643f.png#averageHue=%23fbe8e7&clientId=ua7b2dac9-b0f1-4&from=paste&height=79&id=uf106f5a4&originHeight=157&originWidth=2181&originalType=binary&ratio=2&rotation=0&showTitle=false&size=31886&status=done&style=none&taskId=ua37229d5-71d1-4e93-b1bf-65e83f3b56e&title=&width=1090.5)
:::

<a name="NBoci"></a>
## 编译

**mkdir build**<br />**cd build**<br />**cmake .. -DEVHTP_DISABLE_SSL=ON**<br />**cmake --build .** 该命令编译得到静态库libevhtp/build/libevhtp.a<br />**make examples** 该命令编译得到libevhtp/build/examples文件夹下若干二进制测试程序<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697996137208-9812c25f-2f23-4122-9e39-bf3591c94fb5.png#averageHue=%23f3f2f2&clientId=ua7b2dac9-b0f1-4&from=paste&height=386&id=u6747da39&originHeight=772&originWidth=634&originalType=binary&ratio=2&rotation=0&showTitle=false&size=52591&status=done&style=none&taskId=u3cf400d1-a344-4238-a099-44b74cb6155&title=&width=317)
:::

<a name="zfSEn"></a>
## 测试结果概述


- 我用libevhtp提供的示例程序来进行集成测试，同时，我也使用最原始的libevhtp（没有任何改动，底层网络库为libevent）来运行相同的测试程序，以作对比
- 从对比测试的结果来看，基于libhv的libevhtp和基于libevent的libevhtp在测试程序上的行为是一致的。即使有少部分测试程序的运行情况比较奇怪，但两种libevhtp在这些测试下的运行情况是一样的
:::

<a name="cZRxM"></a>
## 运行测试程序
<a name="VqCFo"></a>
### example_basic

注意，此时是在build目录下。启动example_basic。该程序会启动一个http服务端，响应http客户端的get请求<br />**examples/example_basic**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697997346166-fd58a530-8460-4bcd-a7e4-4d16425e8c2e.png#averageHue=%23fefefc&clientId=ua7b2dac9-b0f1-4&from=paste&height=84&id=u23b41648&originHeight=167&originWidth=1367&originalType=binary&ratio=2&rotation=0&showTitle=false&size=19248&status=done&style=none&taskId=u159f0981-6873-4667-9b21-2fe060125a2&title=&width=683.5)<br />开启另外一个会话窗口，运行以下命令<br />**curl http://127.0.0.1:9999/**<br />**curl http://127.0.0.1:9999/**<br />**curl http://127.0.0.1:9999/**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697997403668-d457f451-8c30-48f9-b7f8-447a43bdb544.png#averageHue=%23fefefe&clientId=ua7b2dac9-b0f1-4&from=paste&height=74&id=u43049ec7&originHeight=148&originWidth=958&originalType=binary&ratio=2&rotation=0&showTitle=false&size=25104&status=done&style=none&taskId=ub564f79b-4990-4654-9423-95f935ec3d6&title=&width=479)<br />可以看到，3次httpget指令正常运行并返回<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697997443176-09064bca-9bd4-4f96-a30a-411a1edaddc4.png#averageHue=%23fefefd&clientId=ua7b2dac9-b0f1-4&from=paste&height=109&id=u9680763b&originHeight=218&originWidth=1484&originalType=binary&ratio=2&rotation=0&showTitle=false&size=42389&status=done&style=none&taskId=u15f656d7-6c7d-46e8-9624-6a8e60bd4de&title=&width=742)
:::
<a name="lA1YT"></a>
### example_chunked

启动example_chunked。该程序会启动一个http服务端，且注意启动该程序需要一个参数，这个参数是一个文件名，当收到http客户端请求时，该程序会将参数指代的文件发送给http客户端。这里我直接用的是build目录下的Makefile文件<br />**./examples/example_chunked Makefile**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697997830532-57ab8d92-47af-4d71-8fe4-e6f318d86906.png#averageHue=%23fefdfb&clientId=ua7b2dac9-b0f1-4&from=paste&height=90&id=u2dca732e&originHeight=179&originWidth=1077&originalType=binary&ratio=2&rotation=0&showTitle=false&size=18456&status=done&style=none&taskId=u07b8b8a6-50c1-447c-b21b-640b16b1502&title=&width=538.5)<br />开启另外一个会话窗口，运行以下命令<br />**curl http://127.0.0.1:9999/**<br />可以看到，example_chunked程序成功将Makefile文件发送给了http客户端<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697997863539-46e0bf5b-bc90-4e3a-91ae-0f61f4b95544.png#averageHue=%23ffffff&clientId=ua7b2dac9-b0f1-4&from=paste&height=480&id=mFqaG&originHeight=959&originWidth=1897&originalType=binary&ratio=2&rotation=0&showTitle=false&size=111892&status=done&style=none&taskId=u0aca1e03-f34f-446b-8d20-97f859bbc42&title=&width=948.5)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697997876076-0f8c9ae6-9047-4184-b030-4417b113e591.png#averageHue=%23faf8ec&clientId=ua7b2dac9-b0f1-4&from=paste&height=446&id=aIoPM&originHeight=892&originWidth=933&originalType=binary&ratio=2&rotation=0&showTitle=false&size=169584&status=done&style=none&taskId=u3d4be93d-c71f-437f-8134-970dc8635a4&title=&width=466.5)
:::

<a name="cpwoo"></a>
### example_pause.c

启动example_pause。该程序会启动一个http服务端，在响应http客户端的请求时，会延迟10s再返回<br />**./examples/example_pause**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697999683707-26093f1b-d6cd-42d7-815c-a24865e3c93b.png#averageHue=%23fefefc&clientId=ua7b2dac9-b0f1-4&from=paste&height=84&id=SV4g4&originHeight=168&originWidth=1486&originalType=binary&ratio=2&rotation=0&showTitle=false&size=20812&status=done&style=none&taskId=u794fdd0e-4e56-4664-b57e-94fa325162c&title=&width=743)<br />开启另外一个会话窗口，运行以下命令<br />**curl http://127.0.0.1:9999/**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697999715115-9c4acf2f-710c-4e7f-bc26-b9a4404fa109.png#averageHue=%23fefefe&clientId=ua7b2dac9-b0f1-4&from=paste&height=81&id=u6d234ad1&originHeight=161&originWidth=953&originalType=binary&ratio=2&rotation=0&showTitle=false&size=18131&status=done&style=none&taskId=u12d3e89e-cf02-42b5-901e-9037fdb2b0e&title=&width=476.5)
:::

<a name="RuwmV"></a>
### example_request_fini

启动example_request_fini。该程序会启动一个http服务端，响应http客户端时，向客户端发送"Hello, world"<br />**./examples/example_request_fini**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697999869805-0d85d35b-86a2-418f-9fe5-49c9c72e2611.png#averageHue=%23fefefc&clientId=ua7b2dac9-b0f1-4&from=paste&height=79&id=uaaf174a1&originHeight=157&originWidth=1912&originalType=binary&ratio=2&rotation=0&showTitle=false&size=26503&status=done&style=none&taskId=ubbb42841-3fa5-47fc-a123-7a56dab03df&title=&width=956)<br />开启另外一个会话窗口，运行以下命令<br />**curl http://127.0.0.1:9999/i/q/z**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1697999921517-e94d75f3-454e-4a02-8c12-424aaafe8643.png#averageHue=%23fefefe&clientId=ua7b2dac9-b0f1-4&from=paste&height=82&id=u6c105c6b&originHeight=164&originWidth=1018&originalType=binary&ratio=2&rotation=0&showTitle=false&size=15948&status=done&style=none&taskId=u816d294d-09e6-4194-8a83-9cec41a31b2&title=&width=509)
:::

<a name="kvvn9"></a>
### example_vhost

启动example_vhost<br />**./examples/example_vhost**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698000128321-e0c832fe-8d82-402a-a068-348d85693f95.png#averageHue=%23fdfcf7&clientId=ua7b2dac9-b0f1-4&from=paste&height=273&id=ud5eeb3c0&originHeight=546&originWidth=1835&originalType=binary&ratio=2&rotation=0&showTitle=false&size=133971&status=done&style=none&taskId=u179bfbaf-1415-4d3c-8cac-26e4d44af6d&title=&width=917.5)<br />开启另外一个会话窗口，运行以下命令<br />**curl -H'Host: evhtp.io' http://127.0.0.1:9999/vhost**<br />**curl -H'Host: www.evhtp.io' http://127.0.0.1:9999/vhost**<br />**curl -H'Host: web.evhtp.io' http://127.0.0.1:9999/vhost**<br />**curl -H'Host: google.com' http://127.0.0.1:9999/vhost**<br />**curl -H'Host: www.google.com' http://127.0.0.1:9999/vhost**<br />**curl -H'Host: web.google.com' http://127.0.0.1:9999/vhost**<br />**curl -H'Host: inbox.google.com' http://127.0.0.1:9999/vhost**<br />**curl -H'Host: gmail.google.com' http://127.0.0.1:9999/vhost**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698000256672-17647b30-814a-4a38-b00e-cae2461407d9.png#averageHue=%23fefefe&clientId=ua7b2dac9-b0f1-4&from=paste&height=308&id=u8c3f987b&originHeight=615&originWidth=1509&originalType=binary&ratio=2&rotation=0&showTitle=false&size=135283&status=done&style=none&taskId=ua0db27a8-378b-445e-b663-737a9fcf51f&title=&width=754.5)
:::

<a name="MZvwF"></a>
### test_basic

启动test_basic<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698000868996-7c463790-c20d-4a6f-96a9-9c43d1759403.png#averageHue=%23fefefe&clientId=ua7b2dac9-b0f1-4&from=paste&height=51&id=u01542af0&originHeight=102&originWidth=912&originalType=binary&ratio=2&rotation=0&showTitle=false&size=8183&status=done&style=none&taskId=uac8a96ed-e385-4dce-99c8-3bcd8050b88&title=&width=456)<br />开启另外一个会话窗口，运行以下命令<br />**curl http://127.0.0.1:8081/simple/**<br />**curl http://127.0.0.1:8081/1/ping**<br />**curl http://127.0.0.1:8081/1/ping.json**<br />**curl http://127.0.0.1:8081/issue161**<br />客户端得到的结果似乎有点奇怪，因此我还使用了最原始的、链接到libevent.so的libevhtp来进行测试。对比二者的结果，发现是一致的<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698000940278-d7211535-0adf-49b7-89ee-042c45610013.png#averageHue=%23fefefe&clientId=ua7b2dac9-b0f1-4&from=paste&height=97&id=ud2027356&originHeight=193&originWidth=1210&originalType=binary&ratio=2&rotation=0&showTitle=false&size=39004&status=done&style=none&taskId=udbed0c78-ba45-47c6-a043-5de568092ad&title=&width=605)
:::

<a name="wEYJT"></a>
### test_client

这里需要修改一下test_client.c中的源码。test_client程序会启动1个http客户端，向指定IP地址发送http请求。test_client.c中原本给出的ip地址无法使用，因此我通过Windows上的nslookup命令获取了www.bilibili.com的IP地址121.194.11.73，并将test_client.c中指定的IP地址替换为该地址<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698001877650-fa3e957c-2195-478d-b5f4-6effc18d0ba3.png#averageHue=%23f9f4f2&clientId=ua7b2dac9-b0f1-4&from=paste&height=124&id=u6e4ada44&originHeight=247&originWidth=1555&originalType=binary&ratio=2&rotation=0&showTitle=false&size=46236&status=done&style=none&taskId=ufa4024ba-fbef-4334-a197-0b68229625b&title=&width=777.5)<br />重新编译测试文件<br />**make examples**<br />启动test_client，它会立即返回<br />**./examples/test_client**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698001931189-fece88bf-8ce3-4560-98d7-4edb60718772.png#averageHue=%23fefefe&clientId=ua7b2dac9-b0f1-4&from=paste&height=73&id=uf66750c6&originHeight=146&originWidth=895&originalType=binary&ratio=2&rotation=0&showTitle=false&size=14895&status=done&style=none&taskId=uf39045f7-b514-4ae1-922b-10a350dd14e&title=&width=447.5)
:::

<a name="sWa2W"></a>
### test_extensive

test_extensive程序是由test.c编译生成的。启动test_extensive<br />**./examples/test_extensive**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698003201722-4997822e-fedf-4146-b942-97a074d483da.png#averageHue=%23fefefe&clientId=ua7b2dac9-b0f1-4&from=paste&height=57&id=u030e4199&originHeight=113&originWidth=952&originalType=binary&ratio=2&rotation=0&showTitle=false&size=8721&status=done&style=none&taskId=u945fa73f-3bd6-4035-9adc-f11d8928b48&title=&width=476)<br />开启另外一个会话窗口，运行以下命令<br />** curl http://127.0.0.1:8081/ref**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698002517491-a02dc59a-628c-4548-b3f9-86526cf2c564.png#averageHue=%23ffffff&clientId=ua7b2dac9-b0f1-4&from=paste&height=238&id=P6XEW&originHeight=475&originWidth=985&originalType=binary&ratio=2&rotation=0&showTitle=false&size=56613&status=done&style=none&taskId=ue6b07cee-f8c1-4a96-ad03-aa6d25fba92&title=&width=492.5)<br />**curl http://127.0.0.1:8081/foo**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698002537041-8658c532-9931-4f5c-96c9-6f52a97963ea.png#averageHue=%23ffffff&clientId=ua7b2dac9-b0f1-4&from=paste&height=243&id=zOmx5&originHeight=485&originWidth=992&originalType=binary&ratio=2&rotation=0&showTitle=false&size=56866&status=done&style=none&taskId=uff6484b0-2c88-4bc6-8e2d-99c0243604c&title=&width=496)<br />**curl http://127.0.0.1:8081/foo/**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698002554146-1367668b-cba2-401f-8e9c-1fa5aa157b79.png#averageHue=%23ffffff&clientId=ua7b2dac9-b0f1-4&from=paste&height=240&id=lfLxt&originHeight=479&originWidth=1003&originalType=binary&ratio=2&rotation=0&showTitle=false&size=57612&status=done&style=none&taskId=ue0498ccf-0da7-4b02-866e-a12bad4e571&title=&width=501.5)<br />**curl http://127.0.0.1:8081/bar**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698002574722-42ba390e-a1d2-4ac3-b781-9c005b9b8ace.png#averageHue=%23ffffff&clientId=ua7b2dac9-b0f1-4&from=paste&height=216&id=QQysJ&originHeight=432&originWidth=997&originalType=binary&ratio=2&rotation=0&showTitle=false&size=53337&status=done&style=none&taskId=u0fc07c4b-01e1-4208-ba78-56f1985fb8f&title=&width=498.5)<br />**curl http://127.0.0.1:8081/500**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698002589797-a91fb4f5-7862-4748-9eb9-d6e0cd4037d0.png#averageHue=%23ffffff&clientId=ua7b2dac9-b0f1-4&from=paste&height=243&id=V0cpe&originHeight=485&originWidth=985&originalType=binary&ratio=2&rotation=0&showTitle=false&size=57277&status=done&style=none&taskId=u28ffb69d-9279-4d30-a64b-c474dcfd24c&title=&width=492.5)<br />**curl http://127.0.0.1:8081/pause**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698002610874-731dd269-76e3-4ac8-b0ca-48281e83d94a.png#averageHue=%23ffffff&clientId=ua7b2dac9-b0f1-4&from=paste&height=69&id=PwNcb&originHeight=138&originWidth=1024&originalType=binary&ratio=2&rotation=0&showTitle=false&size=23613&status=done&style=none&taskId=ueafe6400-f660-4ae0-bb9e-5b749255dca&title=&width=512)<br />**curl http://127.0.0.1:8081/glob/**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698002629539-e425fd6d-ffc1-43b4-9f97-7e41165c21aa.png#averageHue=%23ffffff&clientId=ua7b2dac9-b0f1-4&from=paste&height=238&id=zLG9T&originHeight=476&originWidth=1044&originalType=binary&ratio=2&rotation=0&showTitle=false&size=59786&status=done&style=none&taskId=uc009e18b-3b2c-437d-bce7-6eb8b7db1d6&title=&width=522)<br />**curl http://127.0.0.1:8081/max_body_size**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698002647484-81a9fa46-f51e-4e17-b4e2-e5271ce8b975.png#averageHue=%23ffffff&clientId=ua7b2dac9-b0f1-4&from=paste&height=194&id=JRSC7&originHeight=388&originWidth=1149&originalType=binary&ratio=2&rotation=0&showTitle=false&size=48541&status=done&style=none&taskId=uefe9c54c-5c55-4cbf-b1aa-aa4d1c0ea1d&title=&width=574.5)<br />**curl http://127.0.0.1:8081/chunkme**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698002669645-0775bda9-40e8-4cdb-8754-9e3836107ff8.png#averageHue=%23ffffff&clientId=ua7b2dac9-b0f1-4&from=paste&height=294&id=pcnZg&originHeight=588&originWidth=1054&originalType=binary&ratio=2&rotation=0&showTitle=false&size=74739&status=done&style=none&taskId=u97869951-2ffc-4fc3-9f35-1318131a92a&title=&width=527)<br />**curl http://127.0.0.1:8081/ownme**<br />这条curl命令会一直卡住，不会返回，看起来很奇怪。因此我又使用最原始的libevhtp做了实验，发现的现象也是一直卡住，也就是说，在该命令下，二者的表现情况是一样的<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698002699267-02918190-3806-486e-99aa-4b92c3a0185e.png#averageHue=%23fefefe&clientId=ua7b2dac9-b0f1-4&from=paste&height=55&id=N9BMN&originHeight=109&originWidth=1069&originalType=binary&ratio=2&rotation=0&showTitle=false&size=9985&status=done&style=none&taskId=u0b5a2d0d-58e0-4558-8460-e111f5a686d&title=&width=534.5)
:::

<a name="wEhIG"></a>
### test_perf

test_perf程序有一段复杂的处理命令行参数的代码，为了方便测试，我将该段代码直接注释掉，这样test_perf程序在启动时会使用默认的参数设置<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698003310319-73c6bcfa-f07c-422a-8df0-f8d3e3d3fa28.png#averageHue=%23fefefd&clientId=ua7b2dac9-b0f1-4&from=paste&height=1118&id=u4a8439d0&originHeight=2236&originWidth=1645&originalType=binary&ratio=2&rotation=0&showTitle=false&size=342171&status=done&style=none&taskId=u38755a49-9246-4631-a3a0-e49de4de058&title=&width=822.5)<br />启动test_perf<br />**./examples/test_perf**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698003393732-9fb5280e-5cf1-4ed3-96f0-b605d727ee2a.png#averageHue=%23fefefe&clientId=ua7b2dac9-b0f1-4&from=paste&height=48&id=u85dab8d7&originHeight=96&originWidth=841&originalType=binary&ratio=2&rotation=0&showTitle=false&size=7724&status=done&style=none&taskId=u90607b81-ead8-471f-b663-b604b700b1c&title=&width=420.5)<br />开启另外一个会话窗口，运行以下命令<br />**curl http://127.0.0.1:8081/data**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698003410453-bb77d3af-a952-4811-a6fd-b37ce7623fba.png#averageHue=%23fefefe&clientId=ua7b2dac9-b0f1-4&from=paste&height=59&id=ua0abb533&originHeight=117&originWidth=1908&originalType=binary&ratio=2&rotation=0&showTitle=false&size=17571&status=done&style=none&taskId=u85fae4ca-8539-4221-b4c0-bbf448d5474&title=&width=954)
:::

<a name="BtRSE"></a>
### test_proxy

test_proxy会作为1个代理，转发http客户端的请求。但test_proxy.c的代码中，将远端服务器写死为本地地址，因此需要将其替换为1个可用的地址才行<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698083800797-2cf726b9-9c67-4b9b-a7de-fa9abc413d6e.png#averageHue=%23faf4f3&clientId=ue642572b-b501-4&from=paste&height=166&id=u62997b3e&originHeight=207&originWidth=1403&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=49837&status=done&style=none&taskId=u9bb5ad03-e296-46ee-bf6c-59594e8e8be&title=&width=1122.4)<br />启动test_proxy，注意重新编译一下<br />**make examples**<br />**./examples/test_proxy**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698005207846-291c147d-ef4d-44db-8452-6c5c0db26ca4.png#averageHue=%23fefefe&clientId=ua7b2dac9-b0f1-4&from=paste&height=183&id=uaf589138&originHeight=365&originWidth=865&originalType=binary&ratio=2&rotation=0&showTitle=false&size=34838&status=done&style=none&taskId=ud414c1f1-6d78-4d23-b65c-2608a939412&title=&width=432.5)<br />开启另外一个会话窗口，运行以下命令<br />**curl -x http://127.0.0.1:8081 http://www.baidu.com**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698083780297-3a405cd5-2e67-4f9b-bd97-a3a1ea31bf50.png#averageHue=%23ffffff&clientId=ue642572b-b501-4&from=paste&height=602&id=u171cba06&originHeight=753&originWidth=1795&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=99920&status=done&style=none&taskId=ue35a970a-40d0-4b0a-b941-9addcb18f54&title=&width=1436)
:::

<a name="Ud02w"></a>
### test_query

test_query和底层网络IO没有关系，它主要是测试http头文件解析的功能<br />**./examples/test_query**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698003850093-c93ddbb1-0874-4b54-b11d-2b7e0391216b.png#averageHue=%23fefefe&clientId=ua7b2dac9-b0f1-4&from=paste&height=456&id=u0ae81059&originHeight=911&originWidth=1695&originalType=binary&ratio=2&rotation=0&showTitle=false&size=131620&status=done&style=none&taskId=ud4424b2a-6727-4529-a545-5f50a707d67&title=&width=847.5)
:::

<a name="PQsWl"></a>
### test_vhost

启动test_vhost<br />**./examples/test_vhost**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698004580143-5bc4967e-e9b0-4ed1-a8a3-7de632f1083e.png#averageHue=%23fefefe&clientId=ua7b2dac9-b0f1-4&from=paste&height=49&id=u6c57001f&originHeight=97&originWidth=858&originalType=binary&ratio=2&rotation=0&showTitle=false&size=7859&status=done&style=none&taskId=ubad956cd-77c8-4961-9c34-e0d8dbe86c6&title=&width=429)<br />开启另外一个会话窗口，运行以下命令<br />**curl -i -X POST http://127.0.0.1:8081/host1**<br />**curl -i -X POST http://127.0.0.1:8081/localhost**<br />返回404，奇怪的结果，因此我又使用最原始的libevhtp做了实验，发现也是返回404<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26055455/1698004627123-b34f4f30-c218-4063-913b-d17a101cc668.png#averageHue=%23ffffff&clientId=ua7b2dac9-b0f1-4&from=paste&height=166&id=uc17606a1&originHeight=331&originWidth=1270&originalType=binary&ratio=2&rotation=0&showTitle=false&size=39963&status=done&style=none&taskId=u084fb2c0-726f-4077-8da4-9ed828002b9&title=&width=635)
:::
